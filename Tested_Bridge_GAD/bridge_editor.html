<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Bridge 3-Sheet Online Editor</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body{font-family:Arial;margin:0;padding:1em;background:#fff0f5;color:#4b0082}
    h2{margin-top:0;color:#8b008b}
    .tabs{display:flex;gap:.2em;margin-bottom:.5em}
    .tab{
      cursor:pointer;padding:.4em .8em;border:1px solid #c71585;
      background:#ffb6c1;color:#4b0082;border-radius:4px 4px 0 0;
      transition:all 0.3s ease;
    }
    .tab:hover{
      background:#ff69b4;color:white;
    }
    .tab.active{
      background:#c71585;color:white;font-weight:bold;
      border-bottom: 2px solid #c71585;
    }
    .sheet{display:none;background:white;padding:1em;border:1px solid #c71585;border-radius:0 0 4px 4px;}
    .sheet.active{display:block}
    table{width:100%;border-collapse:collapse;background:#fff;table-layout:fixed;border:1px solid #c71585;}
    th{background:#c71585;color:white;padding:8px;text-align:left;}
    td{border:1px solid #ffb6c1;padding:4px 6px;}
    input{
      width:100%;border:1px solid #ffb6c1;outline:none;box-sizing:border-box;
      padding:4px;background:#fff0f5;color:#4b0082;
    }
    input:focus{
      border-color:#c71585;box-shadow:0 0 0 2px rgba(199, 21, 133, 0.2);
    }
    button{
      margin:.5em .2em;padding:.6em 1em;font-size:1em;
      background:#c71585;color:white;border:none;border-radius:4px;
      cursor:pointer;transition:all 0.3s ease;
    }
    button:hover{
      background:#8b008b;
    }
    /* Specific column widths for sheet1 */
    #tbl1 th:nth-child(1),
    #tbl1 td:nth-child(1) { width: 100px; }
    #tbl1 th:nth-child(2),
    #tbl1 td:nth-child(2) { width: 150px; }
    #tbl1 th:nth-child(3),
    #tbl1 td:nth-child(3) { width: calc(100% - 250px); }
  </style>
</head>
<body>

<h2>Bridge Parameters & Cross-Section Editor</h2>

<!-- TAB BUTTONS -->
<div class="tabs">
  <div class="tab active" onclick="showSheet('sheet1')">Variables</div>
  <div class="tab"        onclick="showSheet('sheet2')">Cross-Section</div>
  <div class="tab"        onclick="showSheet('sheet3')">Pier Details</div>
</div>

<!-- SHEET 1 : VARIABLES -->
<div class="sheet active" id="sheet1">
  <table id="tbl1">
    <thead><tr><th>Value</th><th>Variable</th><th>Description</th></tr></thead>
    <tbody id="tbody1"></tbody>
  </table>
</div>

<!-- SHEET 2 : CHAINAGE / RL -->
<div class="sheet" id="sheet2">
  <table id="tbl2">
    <thead><tr><th>Chainage (x)</th><th>RL (y)</th></tr></thead>
    <tbody id="tbody2"></tbody>
  </table>
</div>

<!-- SHEET 3 : PIER DETAILS -->
<div class="sheet" id="sheet3">
  <table id="tbl3">
    <thead><tr><th>SPAN1</th><th>FUTRL</th><th>FUTD</th><th>FUTW</th><th>FUTL</th></tr></thead>
    <tbody id="tbody3"></tbody>
  </table>
</div>

<button onclick="downloadExcel()">Download Excel</button>

<script>
/* ========== INITIAL DATA ========== */
const sheet1Data = [
  [186,   "SCALE1",  "Scale1"],
  [12.00, "ABTLEN",  "Length Of Abutment Along Current Direction at cap level"],
  [0.30,  "DWTH",    "Dirtwall Thickness"],
  [0.75,  "ALCW",    "Abutment Left Cap Width Excluding D/W"],
  [100.00,"ALFL",    "Abutment Left Footing Level"],
  [100.75,"ARFL",    "Abutment RIGHT Footing Level"],
  [1.20,  "ALCD",    "Abutment Left Cap Depth"],
  [10.00, "ALFB",    "Abt Left Front Batter ( 1 HOR : 10 VER >>>>> VALUE 10)"],
  [101.00,"ALFBL",   "Abt Left  Front Batter RL"],
  [100.75,"ALFBR",   "Abt RIGHT Front Batter RL"],
  [10.00, "ALTB",    "Abt Left  Toe Batter ( 1 HOR : 5 VER >>>>> VALUE 5)"],
  [101.00,"ALTBL",   "Abt Left  Toe Batter Level Footing Top"],
  [100.75,"ALTBR",   "Abt RIGHT  Toe Batter Level Footing Top"],
  [1.50,  "ALFO",    "Abutment Left Front Offset To Footing"],
  [1.00,  "ALFD",    "Abt Left Footing Depth"],
  [3.00,  "ALBB",    "Abt Left Back Batter"],
  [101.00,"ALBBL",   "Abt Left Back Batter RL"],
  [100.75,"ALBBR",   "Abt RIGHT Back Batter RL"],
  [100,   "SCALE2",  "Scale2"],
  [0.00,  "SKEW",    "Degree Of Skew In Plan Of The Bridge"],
  [100.00,"DATUM",   "Datum"],
  [110.98,"TOPRL",   "Top RL Of The Bridge"],
  [0.00,  "LEFT",    "Left Most Chainage Of The Bridge"],
  [43.20, "RIGHT",   "Right Most Chainage Of The Bridge"],
  [10.00, "XINCR",   "Chainage Increment In X Direction"],
  [1.00,  "YINCR",   "Elevation Increment In Y Direction"],
  [21,    "NOCH",    "Total No. Of Chainages On C/S"],
  [4,     "NSPAN",   "Number of Spans"],
  [43.20, "LBRIDGE", "Length Of Bridge"],
  [0.00,  "ABTL",    "Read Chainage Of Left Abutment TO BE INCRESED FOR COMPLETE DRAWING OF APPROACH"],
  [110.98,"RTL",     "Road Top Level"],
  [110.00,"SOFL",    "Soffit Level"],
  [0.23,  "KERBW",   "Width Of Kerb At Deck Top"],
  [0.23,  "KERBD",   "Depth Of Kerb Above Deck Top"],
  [11.10, "CCBR",    "Clear Carriageway Width Of Bridge"],
  [0.90,  "SLBTHC",  "Thickness Of Slab At Centre"],
  [0.75,  "SLBTHE",  "Thickness Of Slab At Edge"],
  [0.75,  "SLBTHT",  "Thickness Of Slab At Tip"],
  [110.00,"CAPT",    "Pier Cap Top RL"],
  [109.40,"CAPB",    "Pier Cap Bottom RL = Pier Top"],
  [1.20,  "CAPW",    "Cap Width"],
  [1.20,  "PIERTW",  "Pier Top Width"],
  [10.00, "BATTR",   "Pier Batter"],
  [12.00, "PIERST",  "Straight Length Of Pier"],
  [1.00,  "PIERN",   "Sr No Of Pier"],
  [10.80, "SPAN1",   "Span Individual Length"],
  [100.00,"FUTRL",   "Founding RL Of Pier Found"],
  [1.00,  "FUTD",    "Depth Of Footing"],
  [4.50,  "FUTW",    "Width Of Rect Footing"],
  [12.00, "FUTL",    "Length Of Footing Along Current Direction"],
  [12.00, "ABTLEN",  "Length Of abutment Along Current Direction"],
  [3.50,  "LASLAB",  "Length of approach slab"],
  [12.00, "APWTH",   "Width of approach slab"],
  [0.38,  "APTHK",   "Thickness of approach slab"],
  [0.08,  "WCTH",    "Thickness of wearing course"]
];

const sheet2Data = [
  [0, 103.00], [3, 103.25], [6, 102.80], [9, 103.05], [12, 102.60],
  [15, 102.85], [18, 102.40], [21, 102.65], [24, 102.20], [27, 102.45],
  [30, 102.00], [33, 102.25], [38, 103.00], [43, 103.25], [48, 102.80],
  [53, 103.05], [58, 102.60], [63, 102.85], [68, 102.40], [73, 102.65],
  [78, 102.20], [83, 102.45], [88, 102.00], [93, 102.25], [98, 101.80],
  [103, 102.05], [108, 101.60], [113, 101.85], [118, 102.10], [123, 101.65],
  [128, 101.90], [133, 101.45], [138, 101.70], [143, 101.95], [148, 102.20],
  [153, 102.45], [158, 102.70], [163, 102.95], [168, 103.20], [173, 103.45],
  [178, 103.70], [183, 103.95], [188, 104.20], [193, 104.45], [198, 104.70],
  [203, 104.95], [208, 105.20], [213, 105.45], [218, 105.70], [223, 105.95],
  [228, 106.20], [233, 106.45], [238, 106.70], [243, 106.95], [248, 107.20],
  [253, 107.45], [258, 107.70], [263, 107.95], [268, 108.20], [273, 108.45],
  [278, 108.70], [283, 108.95], [288, 109.20], [293, 109.45], [298, 109.70],
  [303, 109.95], [308, 110.20], [313, 110.45], [318, 110.70], [323, 110.95]
];

const sheet3Data = [
  [10.8, 98.00, 1.5, 4.5, 15], [10.8, 97.70, 1.5, 4.5, 15],
  [10.8, 97.40, 1.5, 4.5, 15], [10.8, 97.10, 1.5, 4.5, 15],
  [10.8, 96.80, 1.5, 4.5, 15], [10.8, 96.50, 1.5, 4.5, 15],
  [10.8, 96.20, 1.5, 4.5, 15], [10.8, 95.90, 1.5, 4.5, 15],
  [10.8, 95.60, 1.5, 4.5, 15], [10.8, 95.30, 1.5, 4.5, 15],
  [10.8, 95.00, 1.5, 4.5, 15], [10.8, 94.70, 1.5, 4.5, 15],
  [10.8, 94.40, 1.5, 4.5, 15], [10.8, 94.10, 1.5, 4.5, 15],
  [10.8, 93.80, 1.5, 4.5, 15], [10.8, 93.50, 1.5, 4.5, 15],
  [10.8, 93.20, 1.5, 4.5, 15], [10.8, 92.90, 1.5, 4.5, 15],
  [10.8, 92.60, 1.5, 4.5, 15], [10.8, 92.30, 1.5, 4.5, 15],
  [10.8, 92.00, 1.5, 4.5, 15], [10.8, 91.70, 1.5, 4.5, 15],
  [10.8, 91.40, 1.5, 4.5, 15], [10.8, 91.10, 1.5, 4.5, 15],
  [10.8, 90.80, 1.5, 4.5, 15], [10.8, 90.50, 1.5, 4.5, 15],
  [10.8, 90.20, 1.5, 4.5, 15], [10.8, 89.90, 1.5, 4.5, 15],
  [10.8, 89.60, 1.5, 4.5, 15], [10.8, 89.30, 1.5, 4.5, 15],
  [10.8, 89.00, 1.5, 4.5, 15], [10.8, 88.70, 1.5, 4.5, 15],
  [10.8, 88.40, 1.5, 4.5, 15], [10.8, 88.10, 1.5, 4.5, 15],
  [10.8, 87.80, 1.5, 4.5, 15], [10.8, 87.50, 1.5, 4.5, 15],
  [10.8, 87.20, 1.5, 4.5, 15], [10.8, 86.90, 1.5, 4.5, 15],
  [10.8, 86.60, 1.5, 4.5, 15], [10.8, 86.30, 1.5, 4.5, 15],
  [10.8, 86.00, 1.5, 4.5, 15], [10.8, 85.70, 1.5, 4.5, 15],
  [10.8, 85.40, 1.5, 4.5, 15], [10.8, 85.10, 1.5, 4.5, 15],
  [10.8, 84.80, 1.5, 4.5, 15], [10.8, 84.50, 1.5, 4.5, 15],
  [10.8, 84.20, 1.5, 4.5, 15], [10.8, 83.90, 1.5, 4.5, 15],
  [10.8, 83.60, 1.5, 4.5, 15], [10.8, 83.30, 1.5, 4.5, 15],
  [10.8, 83.00, 1.5, 4.5, 15], [10.8, 82.70, 1.5, 4.5, 15],
  [10.8, 82.40, 1.5, 4.5, 15]
];

/* ========== RENDER HELPERS ========== */
function renderTable(data, tbodyId, cols) {
  const tbody = document.getElementById(tbodyId);
  tbody.innerHTML = '';
  data.forEach((row, rowIndex) => {
    const tr = document.createElement('tr');
    cols.forEach((_, colIndex) => {
      const td = document.createElement('td');
      const inp = document.createElement('input');
      inp.type = 'number';
      inp.step = 'any';
      inp.value = row[colIndex] || '';
      
      // Add data attributes for row and column indices
      inp.dataset.row = rowIndex;
      inp.dataset.col = colIndex;
      
      inp.addEventListener('input', e => {
        const value = parseFloat(e.target.value);
        if (!isNaN(value)) {
          data[rowIndex][colIndex] = value;
        } else {
          data[rowIndex][colIndex] = e.target.value;
        }
      });
      
      // Add paste event listener
      inp.addEventListener('paste', handlePaste);
      
      td.appendChild(inp);
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

// Handle paste event for Excel data
function handlePaste(e) {
  e.preventDefault();
  
  // Get the starting cell where paste begins
  const startCell = e.target;
  const startRow = parseInt(startCell.dataset.row);
  const startCol = parseInt(startCell.dataset.col);
  
  // Get the pasted data
  const pasteData = (e.clipboardData || window.clipboardData).getData('text');
  const rows = pasteData.split('\n').filter(row => row.trim() !== '');
  
  // Get the active sheet data based on which table is currently visible
  let activeSheet, tbodyId, cols;
  const activeSheetDiv = document.querySelector('.sheet.active');
  
  if (activeSheetDiv) {
    if (activeSheetDiv.id === 'sheet1') {
      activeSheet = sheet1Data;
      tbodyId = 'tbody1';
      cols = ['Value', 'Variable', 'Description'];
    } else if (activeSheetDiv.id === 'sheet2') {
      activeSheet = sheet2Data;
      tbodyId = 'tbody2';
      cols = ['Chainage', 'RL'];
    } else if (activeSheetDiv.id === 'sheet3') {
      activeSheet = sheet3Data;
      tbodyId = 'tbody3';
      cols = ['SPAN1', 'FUTRL', 'FUTD', 'FUTW', 'FUTL'];
    }
  }
  
  if (!activeSheet) return;
  
  // Process each row of pasted data
  rows.forEach((row, rowOffset) => {
    const cells = row.split('\t');
    cells.forEach((cell, colOffset) => {
      const targetRow = startRow + rowOffset;
      const targetCol = startCol + colOffset;
      
      // Ensure the target row exists
      while (targetRow >= activeSheet.length) {
        activeSheet.push(new Array(cols.length).fill(''));
      }
      
      // Ensure the target column exists in the row
      while (targetCol >= activeSheet[targetRow].length) {
        activeSheet[targetRow].push('');
      }
      
      // Update the cell value
      const value = cell.trim();
      activeSheet[targetRow][targetCol] = isNaN(value) ? value : parseFloat(value);
    });
  });
  
  // Re-render the table to reflect changes
  renderTable(activeSheet, tbodyId, cols);
}

// Add paste event listener to the document to handle pasting outside of inputs
document.addEventListener('paste', function(e) {
  // Only handle if the active element is not an input
  if (e.target.tagName !== 'INPUT') {
    const activeInput = document.querySelector('input:focus');
    if (activeInput) {
      const pasteEvent = new Event('paste', {
        bubbles: true,
        cancelable: true,
        clipboardData: e.clipboardData
      });
      activeInput.dispatchEvent(pasteEvent);
    }
  }
});

// Update the showSheet function to re-render tables when switching tabs
function showSheet(id) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.sheet').forEach(s => s.classList.remove('active'));
  document.querySelector(`.tab[onclick*="${id}"]`).classList.add('active');
  document.getElementById(id).classList.add('active');
  
  // Re-render the table when switching tabs
  if (id === 'sheet1') {
    renderTable(sheet1Data, 'tbody1', ['Value', 'Variable', 'Description']);
  } else if (id === 'sheet2') {
    renderTable(sheet2Data, 'tbody2', ['Chainage', 'RL']);
  } else if (id === 'sheet3') {
    renderTable(sheet3Data, 'tbody3', ['SPAN1', 'FUTRL', 'FUTD', 'FUTW', 'FUTL']);
  }
}

/* ========== TAB SWITCH ========== */
function showSheet(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.sheet').forEach(s=>s.classList.remove('active'));
  document.querySelector('.tab[onclick*="'+id+'"]').classList.add('active');
  document.getElementById(id).classList.add('active');
}

/* ========== DOWNLOAD EXCEL ========== */
function downloadExcel(){
  const wb = XLSX.utils.book_new();
  const ws1 = XLSX.utils.aoa_to_sheet([['Value','Variable','Description'], ...sheet1Data]);
  const ws2 = XLSX.utils.aoa_to_sheet([['Chainage (x)','RL (y)'], ...sheet2Data]);
  const ws3 = XLSX.utils.aoa_to_sheet([['SPAN1','FUTRL','FUTD','FUTW','FUTL'], ...sheet3Data]);
  XLSX.utils.book_append_sheet(wb, ws1, "Sheet1");
  XLSX.utils.book_append_sheet(wb, ws2, "Sheet2");
  XLSX.utils.book_append_sheet(wb, ws3, "Sheet3");
  XLSX.writeFile(wb, 'input.xlsx');
}

// Initial render
renderTable(sheet1Data, 'tbody1', ['Value', 'Variable', 'Description']);
renderTable(sheet2Data, 'tbody2', ['Chainage', 'RL']);
renderTable(sheet3Data, 'tbody3', ['SPAN1', 'FUTRL', 'FUTD', 'FUTW', 'FUTL']);
</script>
</body>
</html>